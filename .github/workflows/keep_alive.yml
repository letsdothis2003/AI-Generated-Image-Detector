name: Keep App Awake

on:
  schedule:
    # This runs every 11 hours to keep the Streamlit app active
    - cron: '0 */11 * * *'
  workflow_dispatch: # Helps with demonstrations without having to deal with Streamlit sleeping 

jobs:
  maintenance_ping:
    name: "Ping Streamlit Cloud Instance"
    runs-on: ubuntu-latest
    
    steps:
      - name: "Timestamping Request"
        run: |
          echo "Initiating keep-alive ping at $(date)"
          echo "Target: https://ai-generated-image-detector-letsdothis2003.streamlit.app"

      - name: "Primary Ping (GET Request)"
        run: |
          # --location-trusted: Passes credentials to redirects
          # --max-redirs: Increases limit to handle Streamlit's wake-up flow
          # --retry: Automatically retries if it fails
          # -k: Insecure mode (ignores SSL issues if wake-up proxy is unstable)
          curl --location-trusted --max-redirs 10 --retry 3 -k -A "Mozilla/5.0 (Windows NT 10.0; Win64; x64) Chrome/120.0.0.0" \
          https://ai-generated-image-detector-letsdothis2003.streamlit.app

      - name: "Final Health Check"
        run: |
          # Wait a few seconds for the app to spin up if it was cold
          sleep 10
          curl -s -o /dev/null -w "HTTP Response Code: %{http_code}\n" --max-time 30 \
          -A "Mozilla/5.0 (Windows NT 10.0; Win64; x64) Chrome/120.0.0.0" \
          https://ai-generated-image-detector-letsdothis2003.streamlit.app
          
      - name: "Completion Summary"
        run: echo "Keep-alive workflow completed."
